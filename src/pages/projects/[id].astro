---
import { Badge } from "@/components/ui/badge";
import { Card, CardContent } from "@/components/ui/card";
import ProjectsLayout from "@/layouts/ProjectsLayout.astro";
import Link from "@/components/Link.astro";
import { getCollection, render } from "astro:content";

export const prerender = true;
export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { id: project.data.title.toLowerCase().replace(/\s+/g, "-") },
    props: { project },
  }));
}

const { project } = Astro.props;

const {
  title,
  description,
  imageURL,
  technologies,
  projectImages,
  demoVideoURL,
} = project.data;

const { Content } = await render(project);
---

<ProjectsLayout title={title}>
  <main class="mx-auto px-4 py-16">
    <section
      class="flex flex-col justify-center items-center max-w-3xl mx-auto mb-12"
    >
      <h1 class="text-4xl font-bold mb-4 md:text-5xl">{title}</h1>
      <p class="text-lg mb-6">{description}</p>
      <div class="flex flex-wrap gap-2 mb-8">
        {
          technologies.map((tech, techIndex) => (
            <Badge key={techIndex} variant="secondary">
              {tech}
            </Badge>
          ))
        }
      </div>
      <div class="">
        <img src={imageURL} alt="" class="rounded-2xl" />
      </div>
    </section>
    <section class="flex flex-col gap-8 max-w-3xl mx-auto md:gap-12">
      <div>
        {
          demoVideoURL && (
            <Card className="bg-surface-200 border-0 shadow-lg">
              <CardContent>
                <iframe
                  class="w-full aspect-video rounded-lg"
                  src="https://www.youtube.com/embed/1PFCJDUbvUU?si=ci7snW22CswmFRmS"
                  title="YouTube video player"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allowfullscreen
                />
              </CardContent>
            </Card>
          )
        }
      </div>
      <article class="prose prose-amber mx-auto p-3">
        <Content components={{ a: Link }} />
      </article>
    </section>
  </main>
</ProjectsLayout>
