---
import { Badge } from "@/components/ui/badge";
import { Card, CardContent } from "@/components/ui/card";
import ProjectsLayout from "@/layouts/ProjectsLayout.astro";
import Link from "@/components/Link.astro";
import { getCollection, render } from "astro:content";

export const prerender = true;
export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { id: project.data.title.toLowerCase().replace(/\s+/g, "-") },
    props: { project },
  }));
}

const { project } = Astro.props;

const {
  title,
  description,
  imageURL,
  technologies,
  projectImages,
  demoVideoURL,
} = project.data;

const { Content } = await render(project);

// Structured Data JSON-LD para proyectos
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CreativeWork",
  name: title,
  description: description,
  image: imageURL,
  author: {
    "@type": "Person",
    name: "Elean Quintero",
    url: "https://eleqful.dev",
  },
  keywords: technologies.join(", "),
};
---

<ProjectsLayout title={title} description={description} image={imageURL}>
  <script
    type="application/ld+json"
    set:html={JSON.stringify(structuredData)}
  />
  <main
    class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 md:py-16"
  >
    <section
      class="flex flex-col justify-center items-center max-w-3xl mx-auto mb-8 sm:mb-12 w-full"
    >
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-4 text-center">
        {title}
      </h1>
      <p class="text-base sm:text-lg mb-6 text-center px-2">{description}</p>
      <div class="flex flex-wrap justify-center gap-2 mb-6 sm:mb-8 px-2">
        {
          technologies.map((tech, techIndex) => (
            <Badge key={techIndex} variant="secondary">
              {tech}
            </Badge>
          ))
        }
      </div>
      <div class="w-full">
        <img
          src={imageURL}
          alt={`Imagen principal del proyecto ${title}`}
          class="rounded-2xl w-full h-auto"
        />
      </div>
    </section>
    <section
      class="flex flex-col gap-6 sm:gap-8 md:gap-12 max-w-3xl mx-auto w-full"
    >
      <div class="w-full">
        {
          demoVideoURL && (
            <Card className="bg-surface-200 border-0 shadow-lg w-full overflow-hidden">
              <CardContent className="p-0 sm:p-2 md:p-4">
                <iframe
                  class="w-full aspect-video rounded-lg"
                  src="https://www.youtube.com/embed/1PFCJDUbvUU?si=ci7snW22CswmFRmS"
                  title="YouTube video player"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allowfullscreen
                />
              </CardContent>
            </Card>
          )
        }
      </div>
      <article class="prose prose-amber max-w-none w-full px-2 sm:px-4 md:px-7">
        <Content components={{ a: Link }} />
      </article>
    </section>
  </main>
</ProjectsLayout>
